<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="description" content="How to test your Meteor application">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Testing | Meteor Guide</title>
    <link rel="icon" href="https://www.meteor.com/favicon.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://guide.meteor.com/style/main.css">
    <link href="http://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="http://s.swiftypecdn.com/assets/new_embed-d6004936e85bea3a6779a7de0ff4f850.css"><style type="text/css">.st-install-h1KW95Mz3fNyf4cnqVtr .st-ui-result .st-ui-type-heading { color:#0089d7 !important }
.st-install-h1KW95Mz3fNyf4cnqVtr .st-ui-result em {font-style:normal; font-weight:bold; background-color:#f6fcfe !important}</style></head>
  <body>
    <div id="wrap">
  <div id="header">
    <div id="top-nav">
  <ul id="top-nav-links">
    
      <li><a href="https://www.meteor.com">Meteor.com</a></li>
    
      <li><a href="https://www.meteor.com/install">Install</a></li>
    
      <li><a href="http://guide.meteor.com">Guide</a></li>
    
      <li><a href="https://www.meteor.com/tutorials/blaze/creating-an-app">Tutorials</a></li>
    
      <li><a href="http://docs.meteor.com">Docs</a></li>
    
      <li><a href="https://forums.meteor.com/">Forums</a></li>
    
  </ul>
</div>

<div id="site-nav">
  <a class="logo" href="/"><img src="http://guide.meteor.com/images/logo-coralspace.svg"></a>
  <span class="sub-title">The Official Guide</span>
  
    <select class="version-select">
      
        <option value="v1.3">1.3</option>
      
        <option value="v1.2">1.2</option>
      
    </select>
  
  
    <input id="search-input" class="search-box st-default-search-input" autocomplete="off" autocorrect="off" autocapitalize="off">
  
</div>

  </div>
  <div id="sidebar">
    <div id="sidebar-mobile">
  <!--
     Disabled search since it doesn't seem to work well
    <input class="search-box st-default-search-input">
    <br>
  -->
  <select class="version-select">
    
      <option value="v1.3">v1.3</option>
    
      <option value="v1.2">v1.2</option>
    
  </select>
</div>

<ul class="categories">
  
    <li>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-1.3.html" class="sidebar-link">
              Introduction
            </a>
          </li>
        
          
          <li>
            <a href="guide-code-style-1.3.html" class="sidebar-link">
              Code style
            </a>
          </li>
        
          
          <li>
            <a href="guide-structure-1.3.html" class="sidebar-link">
              Application structure
            </a>
          </li>
        
          
          <li>
            <a href="1.3-migration.html" class="sidebar-link">
              Migrating to Meteor 1.3
            </a>
          </li>
        
      </ul>
    </li>
  
    <li>
      
        <p>Data</p>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-collections-1.3.html" class="sidebar-link">
              Collections and Schemas
            </a>
          </li>
        
          
          <li>
            <a href="guide-data-loading-1.3.html" class="sidebar-link">
              Publications and Data Loading
            </a>
          </li>
        
          
          <li>
            <a href="guide-methods-1.3.html" class="sidebar-link">
              Methods
            </a>
          </li>
        
          
          <li>
            <a href="guide-accounts-1.3.html" class="sidebar-link">
              Users and Accounts
            </a>
          </li>
        
          
          <li>
            <a href="" class="sidebar-link current">
              Testing
            </a>
          <ul class="sub-menu"><li><a href="#introduction" data-scroll="" class="H2">Introduction</a><ul class="sub-menu"><li><a href="#testing-types" data-scroll="" class="H3">Types of tests</a></li><li><a href="#challenges-with-meteor" data-scroll="" class="H3">Challenges of testing in Meteor</a></li></ul></li><li><a href="#test-modes" data-scroll="" class="H2">The &#x2018;meteor test&#x2019; command</a><ul class="sub-menu"><li><a href="#driver-packages" data-scroll="" class="H3">Driver packages</a></li><li><a href="#mocha" data-scroll="" class="H3">Recommended: Mocha</a></li></ul></li><li><a href="#test-data" data-scroll="" class="H2">Test data</a><ul class="sub-menu"><li><a href="#generating-test-data" data-scroll="" class="H3">Generating test data</a></li><li><a href="#mocking-the-database" data-scroll="" class="H3">Mocking the database</a></li></ul></li><li><a href="#unit-testing" data-scroll="" class="H2">Unit testing</a><ul class="sub-menu"><li><a href="#simple-unit-test" data-scroll="" class="H3">A simple unit test</a></li><li><a href="#running-unit-tests" data-scroll="" class="H3">Running unit tests</a></li><li><a href="#isolation-techniques" data-scroll="" class="H3">Isolation techniques</a></li></ul></li><li><a href="#integration-testing" data-scroll="" class="H2">Integration testing</a><ul class="sub-menu"><li><a href="#simple-integration-test" data-scroll="" class="H3">Simple integration test</a></li><li><a href="#full-app-integration-test" data-scroll="" class="H3">Full-app integration test</a></li><li><a href="#running-full-app-tests" data-scroll="" class="H3">Running full-app tests</a></li><li><a href="#creating-integration-test-data" data-scroll="" class="H3">Creating data</a></li></ul></li><li><a href="#acceptance-testing" data-scroll="" class="H2">Acceptance testing</a><ul class="sub-menu"><li><a href="#running-acceptance-tests" data-scroll="" class="H3">Running acceptance tests</a></li><li><a href="#creating-acceptance-test-data" data-scroll="" class="H3">Creating data</a></li></ul></li><li><a href="#ci" data-scroll="" class="H2">Continuous Integration</a><ul class="sub-menu"><li><a href="#command-line" data-scroll="" class="H3">Command line</a></li><li><a href="#using-circle-ci" data-scroll="" class="H3">CircleCI</a></li></ul></li></ul></li>
        
      </ul>
    </li>
  
    <li>
      
        <p>View</p>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-routing-1.3.html" class="sidebar-link">
              URLs and Routing
            </a>
          </li>
        
          
          <li>
            <a href="guide-ui-ux-1.3.html" class="sidebar-link">
              User Interfaces
            </a>
          </li>
        
          
          <li>
            <a href="guide-blaze-1.3.html" class="sidebar-link">
              Blaze
            </a>
          </li>
        
          
          <li>
            <a href="guide-react-1.3.html" class="sidebar-link">
              React
            </a>
          </li>
        
          
          <li>
            <a href="guide-angular-1.3.html" class="sidebar-link">
              Angular
            </a>
          </li>
        
      </ul>
    </li>
  
    <li>
      
        <p>Build</p>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-using-packages-1.3.html" class="sidebar-link">
              Using Packages
            </a>
          </li>
        
          
          <li>
            <a href="guide-writing-packages-1.3.html" class="sidebar-link">
              Writing Packages
            </a>
          </li>
        
          
          <li>
            <a href="guide-mobile-1.3.html" class="sidebar-link">
              Mobile
            </a>
          </li>
        
          
          <li>
            <a href="guide-build-tool-1.3.html" class="sidebar-link">
              Build system
            </a>
          </li>
        
      </ul>
    </li>
  
    <li>
      
        <p>Production</p>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-security-1.3.html" class="sidebar-link">
              Security
            </a>
          </li>
        
          
          <li>
            <a href="guide-deployment-1.3.html" class="sidebar-link">
              Deployment and Monitoring
            </a>
          </li>
        
      </ul>
    </li>
  
    <li>
      
        <p>Meta</p>
      
      <ul class="menu-root">
        
          
          <li>
            <a href="guide-CONTRIBUTING-1.3.html" class="sidebar-link">
              Contribution guidelines
            </a>
          </li>
        
          
          <li>
            <a href="guide-CHANGELOG-1.3.html" class="sidebar-link">
              Change log
            </a>
          </li>
        
      </ul>
    </li>
  

  </ul></div>
  <div id="content">
    <h1>Testing</h1>
    <p class="edit-discuss-links">
      <a href="https://github.com/meteor/guide/tree/master/content/testing.md" target="_blank">Edit on GitHub</a>
      
        |
        <a href="https://forums.meteor.com/t/20191">Discuss on the Meteor Forums</a>
      
    </p>
    <h2 id="introduction"><a class="anchor" href="#introduction" aria-hidden="true" data-scroll="">&#x1F517;</a>Introduction</h2>

<p>Testing allows you to ensure your application works the way you think it does, especially as your codebase changes over time. If you have good tests, you can refactor and rewrite code with confidence. Tests are also the most concrete form of documentation of expected behavior, since other developers can figure out how to use your code by reading the tests.</p>
<p>Automated testing is critical because it allows you to run a far greater set of tests much more often than you could manually, allowing you to catch regression errors immediately.</p>
<h3 id="testing-types"><a class="anchor" href="#testing-types" aria-hidden="true" data-scroll="">&#x1F517;</a>Types of tests</h3>

<p>Entire books have been written on the subject of testing, so we will simply touch on some basics of testing here. The important thing to consider when writing a test is what part of the application you are trying to test, and how you are verifying the behavior works.</p>
<ul>
<li><p><strong>Unit test</strong>: If you are testing one small module of your application, you are writing a unit test. You&#x2019;ll need to <em>stub</em> and <em>mock</em> other modules that your module usually leverages in order to <em>isolate</em> each test. You&#x2019;ll typically also need to <em>spy</em> on actions that the module takes to verify that they occur.</p>
</li>
<li><p><strong>Integration test</strong>: If you are testing that multiple modules behave properly in concert, you are writing an integration test. Such tests are much more complex and may require running code both on the client and on the server to verify that communication across that divide is working as expected. Typically an integration test will still isolate a part of the entire application and directly verify results in code.</p>
</li>
<li><p><strong>Acceptance test</strong>: If you want to write a test that can be run against any running version of your app and verifies at the browser level that the right things happen when you push the right buttons, then you are writing an acceptance test (sometimes called &#x201C;end to end test&#x201D;). Such tests typically try to hook into the application as little as possible, beyond perhaps setting up the right data to run a test against.</p>
</li>
<li><p><strong>Load test</strong>: Finally you may wish to test that your application works under typical load or see how much load it can handle before it falls over. This is called a load test or stress test. Such tests can be challenging to set up and typically aren&#x2019;t run often but are very important for confidence before a big production launch.</p>
</li>
</ul>
<h3 id="challenges-with-meteor"><a class="anchor" href="#challenges-with-meteor" aria-hidden="true" data-scroll="">&#x1F517;</a>Challenges of testing in Meteor</h3>

<p>In most ways, testing a Meteor app is no different from testing any other full stack JavaScript application. However, compared to more traditional backend or front-end focused frameworks, two factors can make testing a little more challenging:</p>
<ul>
<li><p><strong>Client/server data</strong>: Meteor&#x2019;s data system makes it simple to bridge the client-server gap and often allows you to build your application without thinking about how data moves around. It becomes critical to test that your code does actually work correctly across that gap. In traditional frameworks where you spend a lot of time thinking about interfaces between client and server you can often get away with testing both sides of the interface in isolation, but Meteor&#x2019;s <a href="#test-modes">full app test mode</a> makes it easy to write <a href="#full-app-integration-test">integration tests</a> that cover the full stack. Another challenge here is creating test data in the client context; we&#x2019;ll discuss ways to do this in the <a href="#generating-test-data">section on generating test data</a> below.</p>
</li>
<li><p><strong>Reactivity</strong>: Meteor&#x2019;s reactivity system is &#x201C;eventually consistent&#x201D; in the sense that when you change a reactive input to the system, you&#x2019;ll see the user interface change to reflect this some time later. This can be a challenge when testing, but there are some ways to wait until those changes happen to verify the results, for example <code>Tracker.afterFlush()</code>.</p>
</li>
</ul>
<h2 id="test-modes"><a class="anchor" href="#test-modes" aria-hidden="true" data-scroll="">&#x1F517;</a>The &#x2018;meteor test&#x2019; command</h2>

<p>The primary way to test your application in Meteor is the <code>meteor test</code> command.</p>
<p>This loads your application in a special &#x201C;test mode&#x201D;. What this does is:</p>
<ol>
<li><em>Doesn&#x2019;t</em> eagerly load <em>any</em> of our application code as Meteor normally would.</li>
<li><em>Does</em> eagerly load any file in our application (including in <code>imports/</code> folders) that look like <code>*.test[s].*</code>, or <code>*.spec[s].*</code></li>
<li>Sets the <code>Meteor.isTest</code> flag to be true.</li>
<li>Starts up the test driver package (<a href="#driver-packages">see below</a>).</li>
</ol>
<blockquote>
<p>The <a href="build-tool.html#what-it-does">Meteor build tool</a> and the <code>meteor test</code> command ignore any files located in any <code>tests/</code> directory. This allows you to put tests in this directory that you can run using a test runner outside of Meteor&#x2019;s built-in test tools and still not have those files loaded in your application. See Meteor&#x2019;s <a href="structure.html#load-order">default file load order</a> rules.</p>
</blockquote>
<p>What this means is that you can write tests in files with a certain filename pattern and know they&#x2019;ll not be included in normal builds of your app. When your app runs in test mode, those files will be loaded (and nothing else will), and they can import the modules you want to test. As we&#x2019;ll see this is ideal for <a href="#unit-testing">unit tests</a> and <a href="#simple-integration-test">simple integration tests</a>.</p>
<p>Additionally, Meteor offers a &#x201C;full application&#x201D; test mode. You can run this with <code>meteor test --full-app</code>.</p>
<p>This is similar to test mode, with key differences:</p>
<ol>
<li>It loads test files matching <code>*.app-test[s].*</code> and <code>*.app-spec[s].*</code>.</li>
<li>It <strong>does</strong> eagerly load our application code as Meteor normally would.</li>
</ol>
<p>This means that the entirety of your application (including for instance the web server and client side router) is loaded and will run as normal. This enables you to write much more <a href="#full-app-integration-test">complex integration tests</a> and also load additional files for <a href="#acceptance-testing">acceptance tests</a>.</p>
<p>Note that there is another test command in the Meteor tool; <code>meteor test-packages</code> is a way of testing Atmosphere packages, which we&#x2019;ll discuss in more detail in an upcoming article about writing packages.</p>
<h3 id="driver-packages"><a class="anchor" href="#driver-packages" aria-hidden="true" data-scroll="">&#x1F517;</a>Driver packages</h3>

<p>When you run a <code>meteor test</code> command, you must provide a <code>--driver-package</code> argument. A test driver is a mini-application that runs in place of your app and runs each of your defined tests, whilst reporting the results in some kind of user interface.</p>
<p>There are two main kinds of test driver packages:</p>
<ul>
<li><strong>Web reporters</strong>: Meteor applications that display a special test reporting web UI that you can view the test results in.</li>
</ul>
<p><img src="http://guide.meteor.com/images/mocha-test-results.png"></p>
<ul>
<li><strong>Console reporters</strong>: These run completely on the command-line and are primary used for automated testing like <a href="#ci">continuous integration</a> (as we&#x2019;ll see, typically PhantomJS is used to drive such tests).</li>
</ul>
<h3 id="mocha"><a class="anchor" href="#mocha" aria-hidden="true" data-scroll="">&#x1F517;</a>Recommended: Mocha</h3>

<p>In this article, we&#x2019;ll use the popular <a href="https://mochajs.org" target="_blank" rel="external">Mocha</a> test runner alongside the <a href="http://chaijs.com" target="_blank" rel="external">Chai</a> assertion library to test our application. In order to write tests in Mocha, we can add the <a href="https://atmospherejs.com/avital/mocha" target="_blank" rel="external"><code>practicalmeteor:mocha</code></a> package to our app.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor add practicalmeteor:mocha</span><br></pre></td></tr></tbody></table></figure>
<p>This package also doesn&#x2019;t do anything in development or production mode (in fact it declares itself <code>testOnly</code> so it is not even included in those modes), but when our app is run in <a href="#test-modes">test mode</a>, it takes over, executing test code on both the client and server, and rendering results to the browser.</p>
<p>Test files themselves (for example a file named <code>todos-item.test.js</code> or <code>routing.app-specs.coffee</code>) can register themselves to be run by the test driver in the usual way for that testing library. For Mocha, that&#x2019;s by using <code>describe</code> and <code>it</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note: Arrow function use with Mocha is discouraged.</span></span><br><span class="line"><span class="comment">// (see http://mochajs.org/#arrow-functions)</span></span><br><span class="line">describe(<span class="string">&apos;my module&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  it(<span class="string">&apos;does something that should be tested&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// This code will be executed by the test driver when the app is started</span></span><br><span class="line">    <span class="comment">// in the correct mode</span></span><br><span class="line">  })</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h2 id="test-data"><a class="anchor" href="#test-data" aria-hidden="true" data-scroll="">&#x1F517;</a>Test data</h2>

<p>When your app is run in test mode, it is initialized with a clean test database.</p>
<p>If you are running a test that relies on using the database, and specifically the content of the database, you&#x2019;ll need to perform some <em>setup</em> steps in your test to ensure the database is in the state you expect. There are some tools you can use to do this.</p>
<p>To ensure the database is clean, the <a href="https://atmospherejs.com/xolvio/cleaner" target="_blank" rel="external"><code>xolvio:cleaner</code></a> package is useful. You can use it to reset the database in a <code>beforeEach</code> block:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { resetDatabase } <span class="keyword">from</span> <span class="string">&apos;meteor/xolvio:cleaner&apos;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&apos;my module&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    resetDatabase();</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>This technique will only work on the server. If you need to reset the database from a client test, you can use a method to do so:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { resetDatabase } <span class="keyword">from</span> <span class="string">&apos;meteor/xolvio:cleaner&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">NOTE:</span> Before writing a method like this you&apos;ll want to double check</span></span><br><span class="line"><span class="comment">// that this file is only going to be loaded in test mode!!</span></span><br><span class="line">Meteor.methods({</span><br><span class="line">  <span class="string">&apos;test.resetDatabase&apos;</span>: () =&gt; resetDatabase();</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&apos;my module&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>{</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>{</span><br><span class="line">    <span class="comment">// We need to wait until the method call is done before moving on, so we</span></span><br><span class="line">    <span class="comment">// use Mocha&apos;s async mechanism (calling a done callback)</span></span><br><span class="line">    Meteor.call(<span class="string">&apos;test.resetDatabase&apos;</span>, done);</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>As we&#x2019;ve placed the code above in a test file, it <em>will not</em> load in normal development or production mode (which would be an incredibly bad thing!). If you create a Atmosphere package with a similar feature, you should mark it as <code>testOnly</code> and it will similarly only load in test mode.</p>
<h3 id="generating-test-data"><a class="anchor" href="#generating-test-data" aria-hidden="true" data-scroll="">&#x1F517;</a>Generating test data</h3>

<p>Often it&#x2019;s sensible to create a set of data to run your test against. You can use standard <code>insert()</code> calls against your collections to do this, but often it&#x2019;s easier to create <em>factories</em> which help encode random test data. A great package to use to do this is <a href="https://atmospherejs.com/dburles/factory" target="_blank" rel="external"><code>dburles:factory</code></a>.</p>
<p>In the Todos example app, we define a factory to describe how to create a test todo item, using the <a href="https://www.npmjs.com/package/faker" target="_blank" rel="external"><code>faker</code></a> npm package:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> faker <span class="keyword">from</span> <span class="string">&apos;faker&apos;</span>;</span><br><span class="line"></span><br><span class="line">Factory.define(<span class="string">&apos;todo&apos;</span>, Todos, {</span><br><span class="line">  listId: () =&gt; Factory.get(<span class="string">&apos;list&apos;</span>),</span><br><span class="line">  text: () =&gt; faker.lorem.sentence(),</span><br><span class="line">  createdAt: () =&gt; <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>To use the factory in a test, we simply call <code>Factory.create</code>:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This creates a todo and a list in the database and returns the todo.</span></span><br><span class="line"><span class="keyword">const</span> todo = Factory.create(<span class="string">&apos;todo&apos;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If we have a list already, we can pass in the id and avoid creating another:</span></span><br><span class="line"><span class="keyword">const</span> list = Factory.create(<span class="string">&apos;list&apos;</span>);</span><br><span class="line"><span class="keyword">const</span> todoInList = Factory.create(<span class="string">&apos;todo&apos;</span>, { listId: list._id });</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mocking-the-database"><a class="anchor" href="#mocking-the-database" aria-hidden="true" data-scroll="">&#x1F517;</a>Mocking the database</h3>

<p>As <code>Factory.create</code> directly inserts documents into the collection that&#x2019;s passed into the <code>Factory.define</code> function, it can be a problem to use it on the client. However there&#x2019;s a neat isolation trick that you can do to replace the server-backed <code>Todos</code> <a href="collections.html#client-collections">client collection</a> with a mocked out <a href="#collections.html#local-collections">local collection</a>, that&#x2019;s encoded in the <code>stub-collections</code> package (currently a local package in the Todos example application).</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { StubCollections } <span class="keyword">from</span> <span class="string">&apos;meteor/stub-collections&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Todos } <span class="keyword">from</span> <span class="string">&apos;path/to/todos.js&apos;</span>;</span><br><span class="line"></span><br><span class="line">StubCollections.stub(Todos);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Now Todos is stubbed to a simple local collection mock,</span></span><br><span class="line"><span class="comment">//   so for instance on the client we can do:</span></span><br><span class="line">Todos.insert({ a: <span class="string">&apos;document&apos;</span> });</span><br><span class="line"></span><br><span class="line"><span class="comment">// Restore the `Todos` collection</span></span><br><span class="line">StubCollections.restore();</span><br></pre></td></tr></tbody></table></figure>
<p>In a Mocha test, it makes sense to use <code>stub-collections</code> in a <code>beforeEach</code>/<code>afterEach</code> block.</p>
<h2 id="unit-testing"><a class="anchor" href="#unit-testing" aria-hidden="true" data-scroll="">&#x1F517;</a>Unit testing</h2>

<p>Unit testing is the process of isolating a section of code and then testing that the internals of that section work as you expect. As <a href="guide-structure-1.3.html">we&#x2019;ve split our code base up into ES2015 modules</a> it&#x2019;s natural to test those modules one at a time.</p>
<p>By isolating a module and simply testing its internal functionality, we can write tests that are <em>fast</em> and <em>accurate</em>&#x2014;they can quickly tell you where a problem in your application lies. Note however that incomplete unit tests can often hide bugs because of the way they stub out dependencies. For that reason it&#x2019;s useful to combine unit tests with slower (and perhaps less commonly run) integration and acceptance tests.</p>
<h3 id="simple-unit-test"><a class="anchor" href="#simple-unit-test" aria-hidden="true" data-scroll="">&#x1F517;</a>A simple unit test</h3>

<p>In the Todos example application, thanks to the fact that we&#x2019;ve split our User Interface into <a href="ui-ux.html#components">smart and reusable components</a>, it&#x2019;s natural to want to unit test some of our reusable components (we&#x2019;ll see below how to <a href="#simple-integration-test">integration test</a> our smart components).</p>
<p>To do so, we&#x2019;ll use a very simple test helper that renders a Blaze component off-screen with a given data context (note that the <a href="https://facebook.github.io/react/docs/test-utils.html" target="_blank" rel="external">React test utils</a> can do a similar thing for React). As we place it in <code>imports/ui/test-helpers.js</code> it won&#x2019;t load in our app by in normal mode (as it&#x2019;s not required anywhere):</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> { _ } <span class="keyword">from</span> <span class="string">&apos;meteor/underscore&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Template } <span class="keyword">from</span> <span class="string">&apos;meteor/templating&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Blaze } <span class="keyword">from</span> <span class="string">&apos;meteor/blaze&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Tracker } <span class="keyword">from</span> <span class="string">&apos;meteor/tracker&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withDiv = <span class="function"><span class="keyword">function</span> <span class="title">withDiv</span>(<span class="params">callback</span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">&apos;div&apos;</span>);</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    callback(el);</span><br><span class="line">  } <span class="keyword">finally</span> {</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(el);</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="function"><span class="keyword">function</span> <span class="title">withRenderedTemplate</span>(<span class="params">template, data, callback</span>) </span>{</span><br><span class="line">  withDiv((el) =&gt; {</span><br><span class="line">    <span class="keyword">const</span> ourTemplate = _.isString(template) ? Template[template] : template;</span><br><span class="line">    Blaze.renderWithData(ourTemplate, data, el);</span><br><span class="line">    Tracker.flush();</span><br><span class="line">    callback(el);</span><br><span class="line">  });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>A simple example of a reusable component to test is the <code>Todos_item</code> template. Here&#x2019;s what a unit test looks like (you can see some <a href="https://github.com/meteor/todos/blob/master/imports/ui/components/client/todos-item.tests.js" target="_blank" rel="external">others in the app repository</a>):</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { Factory } <span class="keyword">from</span> <span class="string">&apos;meteor/factory&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { chai } <span class="keyword">from</span> <span class="string">&apos;meteor/practicalmeteor:chai&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Template } <span class="keyword">from</span> <span class="string">&apos;meteor/templating&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { $ } from <span class="string">&apos;meteor/jquery&apos;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { withRenderedTemplate } <span class="keyword">from</span> <span class="string">&apos;../../test-helpers.js&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&apos;../todos-item.js&apos;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&apos;Todos_item&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    Template.registerHelper(<span class="string">&apos;_&apos;</span>, key =&gt; key);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    Template.deregisterHelper(<span class="string">&apos;_&apos;</span>);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&apos;renders correctly with simple data&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> todo = Factory.build(<span class="string">&apos;todo&apos;</span>, { checked: <span class="literal">false</span> });</span><br><span class="line">    <span class="keyword">const</span> data = {</span><br><span class="line">      todo,</span><br><span class="line">      onEditingChange: () =&gt; <span class="number">0</span>,</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    withRenderedTemplate(<span class="string">&apos;Todos_item&apos;</span>, data, el =&gt; {</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">&apos;input[type=text]&apos;</span>).val(), todo.text);</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">&apos;.list-item.checked&apos;</span>).length, <span class="number">0</span>);</span><br><span class="line">      chai.assert.equal($(el).find(<span class="string">&apos;.list-item.editing&apos;</span>).length, <span class="number">0</span>);</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>Of particular interest in this test is the following:</p>
<h4 id="unit-test-importing">Importing</h4>

<p>When we run our app in test mode, only our test files will be eagerly loaded. In particular, this means that in order to use our templates, we need to import them! In this test, we import <code>todos-item.js</code>, which itself imports <code>todos.html</code> (yes, you do need to import the HTML files of your Blaze templates!)</p>
<h4 id="unit-test-stubbing">Stubbing</h4>

<p>To be a unit test, we must stub out the dependencies of the module. In this case, thanks to the way we&#x2019;ve isolated our code into a reusable component, there&#x2019;s not much to do; principally we need to stub out the <code>{{_}}</code> helper that&#x2019;s created by the <a href="ui-ux.html#i18n"><code>tap:i18n</code></a> system. Note that we stub it out in a <code>beforeEach</code> and restore it the <code>afterEach</code>.</p>
<h4 id="unit-test-data">Creating data</h4>

<p>We can use the <a href="#test-data">Factory package&#x2019;s</a> <code>.build()</code> API to create a test document without inserting it into any collection. As we&#x2019;ve been careful not to call out to any collections directly in the reusable component, we can pass the built <code>todo</code> document directly into the template.</p>
<h3 id="running-unit-tests"><a class="anchor" href="#running-unit-tests" aria-hidden="true" data-scroll="">&#x1F517;</a>Running unit tests</h3>

<p>To run the tests that our app defines, we run our app in <a href="#test-modes">test mode</a>:</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --driver-package practicalmeteor:mocha</span><br></pre></td></tr></tbody></table></figure>
<p>As we&#x2019;ve defined a test file (<code>imports/todos/todos.tests.js</code>), what this means is that the file above will be eagerly loaded, adding the <code>&apos;builds correctly from factory&apos;</code> test to the Mocha registry.</p>
<p>To run the tests, visit <a href="http://localhost:3000" target="_blank" rel="external">http://localhost:3000</a> in your browser. This kicks off <code>practicalmeteor:mocha</code>, which runs your tests both in the browser and on the server. It displays the test results in the browser in a Mocha test reporter:</p>
<p><img src="http://guide.meteor.com/images/mocha-test-results.png"></p>
<p>Usually, while developing an application, it make sense to run <code>meteor test</code> on a second port (say <code>3100</code>), while also running your main application in a separate process:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in one terminal window</span></span><br><span class="line">meteor</span><br><span class="line"></span><br><span class="line"><span class="comment"># in another</span></span><br><span class="line">meteor <span class="built_in">test</span> --driver-package practicalmeteor:mocha --port <span class="number">3100</span></span><br></pre></td></tr></tbody></table></figure>
<p>Then you can open two browser windows to see the app in action while also ensuring that you don&#x2019;t break any tests as you make changes.</p>
<h3 id="isolation-techniques"><a class="anchor" href="#isolation-techniques" aria-hidden="true" data-scroll="">&#x1F517;</a>Isolation techniques</h3>

<p>In the <a href="#simple-unit-test">unit test above</a> we saw a very limited example of how to isolate a module from the larger app. This is critical for proper unit testing. Some other utilities and techniques include:</p>
<ul>
<li><p>The <a href="https://atmospherejs.com/velocity/meteor-stubs" target="_blank" rel="external"><code>velocity:meteor-stubs</code></a> package, which creates simple stubs for most Meteor core objects.</p>
</li>
<li><p>Alternatively, you can also use tools like <a href="http://sinonjs.org" target="_blank" rel="external">Sinon</a> to stub things directly, as we&#x2019;ll see for example in our <a href="#simple-integration-test">simple integration test</a>.</p>
</li>
<li><p>The <code>stub-collections</code> package from the Todos example app we mentioned <a href="#mocking-the-database">above</a>.</p>
</li>
<li><p>(Using another package from the example app) to isolate a publication, the <code>publication-collector</code> package:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&apos;lists.public&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  it(<span class="string">&apos;sends all public lists&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>{</span><br><span class="line">    <span class="comment">// Allows us to look at the output of a publication without</span></span><br><span class="line">    <span class="comment">// needing a client connection</span></span><br><span class="line">    <span class="keyword">const</span> collector = <span class="keyword">new</span> PublicationCollector();</span><br><span class="line">    collector.collect(<span class="string">&apos;lists.public&apos;</span>, (collections) =&gt; {</span><br><span class="line">      chai.assert.equal(collections.Lists.length, <span class="number">3</span>);</span><br><span class="line">      done();</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p>There&#x2019;s a lot of scope for better isolation and testing utilities (the two packages from the example app above could be improved greatly!). We encourage the community to take the lead on these.</p>
<h2 id="integration-testing"><a class="anchor" href="#integration-testing" aria-hidden="true" data-scroll="">&#x1F517;</a>Integration testing</h2>

<p>An integration test is a test that crosses module boundaries. In the simplest case, this simply means something very similar to a unit test, where you perform your isolation around multiple modules, creating a non-singular &#x201C;system under test&#x201D;.</p>
<p>Although conceptually different to unit tests, such tests typically do not need to be run any differently to unit tests and can use the same <a href="#running-unit-tests"><code>meteor test</code> mode</a> and <a href="#isolation-techniques">isolation techniques</a> as we use for unit tests.</p>
<p>However, an integration test that crosses the client-server boundary of a Meteor application (where the modules under test cross that boundary) requires a different testing infrastructure, namely Meteor&#x2019;s &#x201C;full app&#x201D; testing mode.</p>
<p>Let&#x2019;s take a look at example of both kinds of tests.</p>
<h3 id="simple-integration-test"><a class="anchor" href="#simple-integration-test" aria-hidden="true" data-scroll="">&#x1F517;</a>Simple integration test</h3>

<p>Our reusable components were a natural fit for a unit test; similarly our smart components tend to require an integration test to really be exercised properly, as the job of a smart component is to bring data together and supply it to a reusable component.</p>
<p>In the Todos example app, we have an integration test for the <code>Lists_show_page</code> smart component. This test simply ensures that when the correct data is present in the database, the template renders correctly &#x2013; that it is gathering the correct data as we expect. It isolates the rendering tree from the more complex data subscription part of the Meteor stack. If we wanted to test that the subscription side of things was working in concert with the smart component, we&#x2019;d need to write a <a href="#full-app-integration-test">full app integration test</a>.</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { Meteor } <span class="keyword">from</span> <span class="string">&apos;meteor/meteor&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Factory } <span class="keyword">from</span> <span class="string">&apos;meteor/factory&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Random } <span class="keyword">from</span> <span class="string">&apos;meteor/random&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { chai } <span class="keyword">from</span> <span class="string">&apos;meteor/practicalmeteor:chai&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { StubCollections } <span class="keyword">from</span> <span class="string">&apos;meteor/stub-collections&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Template } <span class="keyword">from</span> <span class="string">&apos;meteor/templating&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { _ } <span class="keyword">from</span> <span class="string">&apos;meteor/underscore&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { $ } from <span class="string">&apos;meteor/jquery&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { FlowRouter } <span class="keyword">from</span> <span class="string">&apos;meteor/kadira:flow-router&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { sinon } <span class="keyword">from</span> <span class="string">&apos;meteor/practicalmeteor:sinon&apos;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { withRenderedTemplate } <span class="keyword">from</span> <span class="string">&apos;../../test-helpers.js&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&apos;../lists-show-page.js&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { Todos } <span class="keyword">from</span> <span class="string">&apos;../../../api/todos/todos.js&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Lists } <span class="keyword">from</span> <span class="string">&apos;../../../api/lists/lists.js&apos;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&apos;Lists_show_page&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> listId = Random.id();</span><br><span class="line"></span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    StubCollections.stub([Todos, Lists]);</span><br><span class="line">    Template.registerHelper(<span class="string">&apos;_&apos;</span>, key =&gt; key);</span><br><span class="line">    sinon.stub(FlowRouter, <span class="string">&apos;getParam&apos;</span>, () =&gt; listId);</span><br><span class="line">    sinon.stub(Meteor, <span class="string">&apos;subscribe&apos;</span>, () =&gt; ({</span><br><span class="line">      subscriptionId: <span class="number">0</span>,</span><br><span class="line">      ready: () =&gt; <span class="literal">true</span>,</span><br><span class="line">    }));</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    StubCollections.restore();</span><br><span class="line">    Template.deregisterHelper(<span class="string">&apos;_&apos;</span>);</span><br><span class="line">    FlowRouter.getParam.restore();</span><br><span class="line">    Meteor.subscribe.restore();</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&apos;renders correctly with simple data&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    Factory.create(<span class="string">&apos;list&apos;</span>, { _id: listId });</span><br><span class="line">    <span class="keyword">const</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> todos = _.times(<span class="number">3</span>, i =&gt; Factory.create(<span class="string">&apos;todo&apos;</span>, {</span><br><span class="line">      listId,</span><br><span class="line">      createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>(timestamp - (<span class="number">3</span> - i)),</span><br><span class="line">    }));</span><br><span class="line"></span><br><span class="line">    withRenderedTemplate(<span class="string">&apos;Lists_show_page&apos;</span>, {}, el =&gt; {</span><br><span class="line">      <span class="keyword">const</span> todosText = todos.map(t =&gt; t.text).reverse();</span><br><span class="line">      <span class="keyword">const</span> renderedText = $(el).find(<span class="string">&apos;.list-items input[type=text]&apos;</span>)</span><br><span class="line">        .map((i, e) =&gt; $(e).val())</span><br><span class="line">        .toArray();</span><br><span class="line">      chai.assert.deepEqual(renderedText, todosText);</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<p>Of particular interest in this test is the following:</p>
<h4 id="simple-integration-test-importing">Importing</h4>

<p>As we&#x2019;ll run this test in the same way that we did our unit test, we need to <code>import</code> the relevant modules under test in the same way that we <a href="#simple-integration-test-importing">did in the unit test</a>.</p>
<h4 id="simple-integration-test-stubbing">Stubbing</h4>

<p>As the system under test in our integration test has a larger surface area, we need to stub out a few more points of integration with the rest of the stack. Of particular interest here is our use of the <a href="#mocking-the-database"><code>stub-collections</code></a> and of <a href="https://sinonjs.org" target="_blank" rel="external">Sinon</a> to stub out Flow Router and our Subscription.</p>
<h4 id="simple-integration-test-data">Creating data</h4>

<p>In this test, we used <a href="#test-data">Factory package&#x2019;s</a> <code>.create()</code> API, which inserts data into the real collection. However, as we&#x2019;ve proxied all of the <code>Todos</code> and <code>Lists</code> collection methods onto a local collection (this is what <code>stub-collections</code> is doing), we won&#x2019;t run into any problems with trying to perform inserts from the client.</p>
<p>This integration test can be run the exact same way as we ran <a href="#running-unit-tests">unit tests above</a>.</p>
<h3 id="full-app-integration-test"><a class="anchor" href="#full-app-integration-test" aria-hidden="true" data-scroll="">&#x1F517;</a>Full-app integration test</h3>

<p>In the Todos example application, we have a integration test which ensures that we see the full contents of a list when we route to it, which demonstrates a few techniques of integration tests:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { Meteor } <span class="keyword">from</span> <span class="string">&apos;meteor/meteor&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Tracker } <span class="keyword">from</span> <span class="string">&apos;meteor/tracker&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { DDP } <span class="keyword">from</span> <span class="string">&apos;meteor/ddp-client&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { FlowRouter } <span class="keyword">from</span> <span class="string">&apos;meteor/kadira:flow-router&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { assert } <span class="keyword">from</span> <span class="string">&apos;meteor/practicalmeteor:chai&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Promise } <span class="keyword">from</span> <span class="string">&apos;meteor/promise&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { $ } from <span class="string">&apos;meteor/jquery&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { generateData } <span class="keyword">from</span> <span class="string">&apos;./../../api/generate-data.app-tests.js&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Lists } <span class="keyword">from</span> <span class="string">&apos;../../api/lists/lists.js&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Todos } <span class="keyword">from</span> <span class="string">&apos;../../api/todos/todos.js&apos;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Utility -- returns a promise which resolves when all subscriptions are done</span></span><br><span class="line"><span class="keyword">const</span> waitForSubscriptions = () =&gt; <span class="keyword">new</span> <span class="built_in">Promise</span>(resolve =&gt; {</span><br><span class="line">  <span class="keyword">const</span> poll = Meteor.setInterval(() =&gt; {</span><br><span class="line">    <span class="keyword">if</span> (DDP._allSubscriptionsReady()) {</span><br><span class="line">      clearInterval(poll);</span><br><span class="line">      resolve();</span><br><span class="line">    }</span><br><span class="line">  }, <span class="number">200</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tracker.afterFlush runs code when all consequent of a tracker based change</span></span><br><span class="line"><span class="comment">//   (such as a route change) have occured. This makes it a promise.</span></span><br><span class="line"><span class="keyword">const</span> afterFlushPromise = <span class="built_in">Promise</span>.denodeify(Tracker.afterFlush);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Meteor.isClient) {</span><br><span class="line">    describe(<span class="string">&apos;data available when routed&apos;</span>, () =&gt; {</span><br><span class="line">    <span class="comment">// First, ensure the data that we expect is loaded on the server</span></span><br><span class="line">    <span class="comment">//   Then, route the app to the homepage</span></span><br><span class="line">    beforeEach(() =&gt; generateData().then(() =&gt; FlowRouter.go(<span class="string">&apos;/&apos;</span>)));</span><br><span class="line"></span><br><span class="line">    describe(<span class="string">&apos;when logged out&apos;</span>, () =&gt; {</span><br><span class="line">      it(<span class="string">&apos;has all public lists at homepage&apos;</span>, () =&gt; {</span><br><span class="line">        assert.equal(Lists.find().count(), <span class="number">3</span>);</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line">      it(<span class="string">&apos;renders the correct list when routed to&apos;</span>, () =&gt; {</span><br><span class="line">        <span class="keyword">const</span> list = Lists.findOne();</span><br><span class="line">        FlowRouter.go(<span class="string">&apos;Lists.show&apos;</span>, { _id: list._id });</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> afterFlushPromise()</span><br><span class="line">          .then(() =&gt; {</span><br><span class="line">            assert.equal($(<span class="string">&apos;.title-wrapper&apos;</span>).html(), list.name);</span><br><span class="line">          })</span><br><span class="line">          .then(() =&gt; waitForSubscriptions())</span><br><span class="line">          .then(() =&gt; {</span><br><span class="line">            assert.equal(Todos.find({ listId: list._id }).count(), <span class="number">3</span>);</span><br><span class="line">          });</span><br><span class="line">      });</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Of note here:</p>
<ul>
<li><p>Before running, each test sets up the data it needs using the <code>generateData</code> helper (see <a href="#creating-integration-test-data">the section on creating integration test data</a> for more detail) then goes to the homepage.</p>
</li>
<li><p>Although Flow Router doesn&#x2019;t take a done callback, we can use <code>Tracker.afterFlush</code> to wait for all its reactive consequences to occur.</p>
</li>
<li><p>Here we wrote a little utility (which could be abstracted into a general package) to wait for all the subscriptions which are created by the route change (the <code>todos.inList</code> subscription in this case) to become ready before checking their data.</p>
</li>
</ul>
<h3 id="running-full-app-tests"><a class="anchor" href="#running-full-app-tests" aria-hidden="true" data-scroll="">&#x1F517;</a>Running full-app tests</h3>

<p>To run the <a href="#test-modes">full-app tests</a> in our application, we run:</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --full-app --driver-package practicalmeteor:mocha</span><br></pre></td></tr></tbody></table></figure>
<p>When we connect to the test instance in a browser, we want to render a testing UI rather than our app UI, so the <code>mocha-web-reporter</code> package will hide any UI of our application and overlay it with its own. However the app continues to behave as normal, so we are able to route around and check the correct data is loaded.</p>
<h3 id="creating-integration-test-data"><a class="anchor" href="#creating-integration-test-data" aria-hidden="true" data-scroll="">&#x1F517;</a>Creating data</h3>

<p>To create test data in full-app test mode, it usually makes sense to create some special test methods which we can call from the client side. Usually when testing a full app, we want to make sure the publications are sending through the correct data (as we do in this test), and so it&#x2019;s not sufficient to stub out the collections and place synthetic data in them. Instead we&#x2019;ll want to actually create data on the server and let it be published.</p>
<p>Similar to the way we cleared the database using a method in the <code>beforeEach</code> in the <a href="#test-data">test data</a> section above, we can call a method to do that before running our tests. In the case of our routing tests, we&#x2019;ve used a file called <code>imports/api/generate-data.app-tests.js</code> which defines this method (and will only be loaded in full app test mode, so is not available in general!):</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file will be auto-imported in the app-test context,</span></span><br><span class="line"><span class="comment">// ensuring the method is always available</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> { Meteor } <span class="keyword">from</span> <span class="string">&apos;meteor/meteor&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Factory } <span class="keyword">from</span> <span class="string">&apos;meteor/factory&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { resetDatabase } <span class="keyword">from</span> <span class="string">&apos;meteor/xolvio:cleaner&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { Random } <span class="keyword">from</span> <span class="string">&apos;meteor/random&apos;</span>;</span><br><span class="line"><span class="keyword">import</span> { _ } <span class="keyword">from</span> <span class="string">&apos;meteor/underscore&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createList = (userId) =&gt; {</span><br><span class="line">  <span class="keyword">const</span> list = Factory.create(<span class="string">&apos;list&apos;</span>, { userId });</span><br><span class="line">  _.times(<span class="number">3</span>, () =&gt; Factory.create(<span class="string">&apos;todo&apos;</span>, { listId: list._id }));</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remember to double check this is a test-only file before</span></span><br><span class="line"><span class="comment">// adding a method like this!</span></span><br><span class="line">Meteor.methods({</span><br><span class="line">  generateFixtures: <span class="function"><span class="keyword">function</span> <span class="title">generateFixturesMethod</span>(<span class="params"></span>) </span>{</span><br><span class="line">    resetDatabase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create 3 public lists</span></span><br><span class="line">    _.times(<span class="number">3</span>, () =&gt; createList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create 3 private lists</span></span><br><span class="line">    _.times(<span class="number">3</span>, () =&gt; createList(Random.id()));</span><br><span class="line">  },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> generateData;</span><br><span class="line"><span class="keyword">if</span> (Meteor.isClient) {</span><br><span class="line">  <span class="comment">// Create a second connection to the server to use to call</span></span><br><span class="line">  <span class="comment">// test data methods. We do this so there&apos;s no contention</span></span><br><span class="line">  <span class="comment">// with the currently tested user&apos;s connection.</span></span><br><span class="line">  <span class="keyword">const</span> testConnection = Meteor.connect(Meteor.absoluteUrl());</span><br><span class="line"></span><br><span class="line">  generateData = <span class="built_in">Promise</span>.denodeify((cb) =&gt; {</span><br><span class="line">    testConnection.call(<span class="string">&apos;generateFixtures&apos;</span>, cb);</span><br><span class="line">  });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> { generateData };</span><br></pre></td></tr></tbody></table></figure>
<p>Note that we&#x2019;ve exported a client-side symbol <code>generateData</code> which is a promisified version of the method call, which makes it simpler to use this sequentially in tests.</p>
<p>Also of note is the way we use a second DDP connection to the server in order to send these test &#x201C;control&#x201D; method calls.</p>
<h2 id="acceptance-testing"><a class="anchor" href="#acceptance-testing" aria-hidden="true" data-scroll="">&#x1F517;</a>Acceptance testing</h2>

<p>Acceptance testing is the process of taking an unmodified version of our application and testing it from the &#x201C;outside&#x201D; to make sure it behaves in a way we expect. Typically if an app passes acceptance tests, we have done our job properly from a product perspective.</p>
<p>As acceptance tests test the behavior of the application in a full browser context in a generic way, there are a range of tools that you can to specify and run such tests. In this guide we&#x2019;ll demonstrate using <a href="https://chimp.readme.io" target="_blank" rel="external">Chimp</a>, an acceptance testing tool with a few neat Meteor-specific features that makes it easy to use.</p>
<p>We can install the Chimp tool globally using:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor npm install --global chimp</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>Note that you can also install Chimp as a <code>devDependency</code> in your <code>package.json</code> but you may run into problems deploying your application as it includes binary dependencies. You can avoid such problems by running <code>meteor npm prune</code> to remove non-production dependencies before deploying.</p>
</blockquote>
<p>Chimp has a variety of options for setting it up, but we can add some npm scripts which will run the currently tests we define in Chimp&#x2019;s two main modes. We can add them to our <code>package.json</code>:</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">scripts</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">chimp-watch</span>&quot;: <span class="value"><span class="string">&quot;chimp --ddp=http://localhost:3000 --watch --mocha --path=tests&quot;</span></span>,</span><br><span class="line">    &quot;<span class="attribute">chimp-test</span>&quot;: <span class="value"><span class="string">&quot;chimp --mocha --path=tests&quot;</span></span><br><span class="line">  </span>}</span><br><span class="line"></span>}</span><br></pre></td></tr></tbody></table></figure>
<p>Chimp will now look in the <code>tests/</code> directory (otherwise ignored by the Meteor tool) for files in which you define acceptance tests. In the Todos example app, we define a simple test that ensures we can click the &#x201C;create list&#x201D; button:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-env mocha */</span></span><br><span class="line"><span class="comment">/* eslint-disable func-names, prefer-arrow-callback */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These are Chimp globals</span></span><br><span class="line"><span class="comment">/* globals browser assert server */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countLists</span>(<span class="params"></span>) </span>{</span><br><span class="line">  browser.waitForExist(<span class="string">&apos;.list-todo&apos;</span>);</span><br><span class="line">  <span class="keyword">const</span> elements = browser.elements(<span class="string">&apos;.list-todo&apos;</span>);</span><br><span class="line">  <span class="keyword">return</span> elements.value.length;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&apos;list ui&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    browser.url(<span class="string">&apos;http://localhost:3000&apos;</span>);</span><br><span class="line">    server.call(<span class="string">&apos;generateFixtures&apos;</span>);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&apos;can create a list @watch&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> initialCount = countLists();</span><br><span class="line"></span><br><span class="line">    browser.click(<span class="string">&apos;.js-new-list&apos;</span>);</span><br><span class="line"></span><br><span class="line">    assert.equal(countLists(), initialCount + <span class="number">1</span>);</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>
<h3 id="running-acceptance-tests"><a class="anchor" href="#running-acceptance-tests" aria-hidden="true" data-scroll="">&#x1F517;</a>Running acceptance tests</h3>

<p>To run acceptance tests, we simply need to start our Meteor app as usual, and point Chimp at it.</p>
<p>In one terminal, we can do:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor</span><br></pre></td></tr></tbody></table></figure>
<p>In another:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor npm run chimp-watch</span><br></pre></td></tr></tbody></table></figure>
<p>The <code>chimp-watch</code> command will then run the test in a browser, and continue to re-run it as we change the test or the application. (Note that the test assumes we are running the app on port <code>3000</code>).</p>
<p>Thus it&#x2019;s a good way to develop the test&#x2014;this is why chimp has a feature where we mark tests with a <code>@watch</code> in the name to call out the tests we want to work on (running our entire acceptance test suite can be time consuming in a large application).</p>
<p>The <code>chimp-test</code> command will run all of the tests <em>once only</em> and is good for testing that our suite passes, either as a manual step, or as part of a <a href="#ci">continuous integration</a> process.</p>
<h3 id="creating-acceptance-test-data"><a class="anchor" href="#creating-acceptance-test-data" aria-hidden="true" data-scroll="">&#x1F517;</a>Creating data</h3>

<p>Although we can run the acceptance test against our &#x201C;pure&#x201D; Meteor app, as we&#x2019;ve done above, it often makes sense to start our meteor server with a special test driver, <code>tmeasday:acceptance-test-driver</code>. (You&#x2019;ll need to <code>meteor add</code> it to your app):</p>
<figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meteor test --full-app --driver-package tmeasday:acceptance-test-driver</span><br></pre></td></tr></tbody></table></figure>
<p>The advantage of running our acceptance test suite pointed at an app that runs in full app test mode is that all of the <a href="#creating-integration-test-data">data generating methods</a> that we&#x2019;ve created remain available. Otherwise the <code>acceptance-test-driver</code> does nothing.</p>
<p>In Chimp tests, you have a DDP connection to the server available on the <code>server</code> variable. You can thus use <code>server.call()</code> (which is wrapped to be synchronous in Chimp tests) to call these methods. This is a convenient way to share data preparation code between acceptance and integration tests.</p>
<h2 id="ci"><a class="anchor" href="#ci" aria-hidden="true" data-scroll="">&#x1F517;</a>Continuous Integration</h2>

<p>Continuous integration testing is the process of running tests on every commit of your project.</p>
<p>There are two principal ways to do it: on the developer&#x2019;s machine before allowing them to push code to the central repository, and on a dedicated CI server after each push. Both techniques are useful, and both require running tests in a commandline-only fashion.</p>
<h3 id="command-line"><a class="anchor" href="#command-line" aria-hidden="true" data-scroll="">&#x1F517;</a>Command line</h3>

<p>We&#x2019;ve seen one example of running tests on the command line, using our <code>meteor npm run chimp-test</code> mode.</p>
<p>We can also use a command-line driver for Mocha <a href="http://atmospherejs.com/dispatch/mocha-phantomjs" target="_blank" rel="external"><code>dispatch:mocha-phantomjs</code></a> to run our standard tests on the command line.</p>
<p>Adding and using the package is straightforward:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meteor add dispatch:mocha-phantomjs</span><br><span class="line">meteor <span class="built_in">test</span> --once --driver-package dispatch:mocha-phantomjs</span><br></pre></td></tr></tbody></table></figure>
<p>(The <code>--once</code> argument ensures the Meteor process stops once the test is done).</p>
<p>We can also add that command to our <code>package.json</code> as a <code>test</code> script:</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  &quot;<span class="attribute">scripts</span>&quot;: <span class="value">{</span><br><span class="line">    &quot;<span class="attribute">test</span>&quot;: <span class="value"><span class="string">&quot;meteor test --once --driver-package dispatch:mocha-phantomjs&quot;</span></span><br><span class="line">  </span>}</span><br><span class="line"></span>}</span><br></pre></td></tr></tbody></table></figure>
<p>Now we can run the tests with <code>meteor npm test</code>.</p>
<h3 id="using-circle-ci"><a class="anchor" href="#using-circle-ci" aria-hidden="true" data-scroll="">&#x1F517;</a>CircleCI</h3>

<p><a href="https://circleci.com" target="_blank" rel="external">CircleCI</a> is a great continuous integration service that allows us to run (possibly time consuming) tests on every push to a repository like GitHub. To use it with the the commandline test we&#x2019;ve defined above, we can follow their standard <a href="https://circleci.com/docs/getting-started" target="_blank" rel="external">getting started tutorial</a> and use a <code>circle.yml</code> file similar to this:</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">machine</span>:</span><br><span class="line">  <span class="attribute">node</span>:</span><br><span class="line">    <span class="attribute">version</span>: <span class="number">0.10</span>.<span class="number">43</span></span><br><span class="line"><span class="attribute">dependencies</span>:</span><br><span class="line">  <span class="attribute">override</span>:</span><br><span class="line">    - curl <span class="attribute">https</span>:<span class="comment">//install.meteor.com | /bin/sh</span></span><br><span class="line">    - npm install</span><br><span class="line"><span class="attribute">checkout</span>:</span><br><span class="line">  <span class="attribute">post</span>:</span><br><span class="line">    - git submodule update --init</span><br></pre></td></tr></tbody></table></figure>

    <div class="bottom-nav">
      
      
        <span>&#x2190; <a href="guide-accounts-1.3.html">Users and Accounts</a></span>
      
      
        <span style="float:right"><a href="guide-routing-1.3.html">URLs and Routing</a> &#x2192;</span>
      
    </div>
    <p class="edit-link">
      <a href="https://github.com/meteor/guide/tree/master/content/testing.md" target="_blank">Edit this page on GitHub</a>
    </p>
    
      <div id="discourse-comments"><iframe src="https://forums.meteor.com/embed/comments?topic_id=20191" id="discourse-embed-frame" width="100%" frameborder="0" scrolling="no" height="1295px"></iframe></div>

      
    
  </div>

  <!-- mobile only -->
  <div id="mobile-header">
    <a class="menu-button"></a>
    <a class="logo" href="/">
      <img src="http://guide.meteor.com/images/logo.svg">
    </a>
  </div>
  <div id="mobile-shade"></div>

</div>

    
    
    
    
  

<div class="st-injected-content-generated st-install-h1KW95Mz3fNyf4cnqVtr" data-st-install-key="h1KW95Mz3fNyf4cnqVtr" id="st-injected-content">
<div class="st-ui-embed st-search-chrome-overlay-output st-search-escape-hide-outputs st-search-zoom-on-mobile" style="display: none; ">
    <div class="st-ui-overlay st-search-hide-outputs"></div>
  <!-- Swiftype input and results overlay -->
  <div class="st-ui-container st-ui-container-overlay  st-ui-injected-overlay-container ">
    <!-- HEADER -->
    <div class="st-ui-container-header_bar st-position-container">
        <section class="st-ui-header">
          <form>
            <input class="st-default-search-input st-search-set-focus" type="text" value="" placeholder="Search this site" id="st-overlay-search-input" autocomplete="off" autocorrect="off" autocapitalize="off">
          </form>
          <span class="st-ui-search-icon"></span>

            <a class="st-ui-close-button st-search-hide-outputs">Close</a>

            <a class="st-ui-stamp" href="https://swiftype.com" target="_blank">search by swiftype</a>
        </section>
    </div>

    <!-- LEFT SIDEBAR -->
    <div class="st-ui-container-left_sidebar st-position-container">
      <div class="st-ui-injected-search-controls">
      </div>
    </div>

    <!-- RIGHT SIDEBAR -->
    <div class="st-ui-container-right_sidebar st-position-container">
      <div class="st-ui-injected-container-right_sidebar">
        <div class="st-ui-injected-search-controls">
        </div>
      </div>
    </div>

    <!-- PRIMARY CONTENT -->
    <div class="st-ui-container-primary_content st-position-container">
        <section class="st-ui-slide-autocomplete st-autocomplete-keyboard-navigable st-autocomplete-transient-on-select-and-results" data-st-target-element="#st-overlay-search-input" data-st-active-query-class="active" style="display: none; ">
          <span class="st-ui-type-heading-small">suggested results</span>
          <div class="st-autocomplete-results"><div class="st-query-present" style="display: none; "></div></div>
        </section>

        <section class="st-ui-content st-search-results"><div class="st-query-not-present">
          <span class="st-ui-fallback"></span>
        </div><div class="st-query-present" style="display: none; "></div></section>

      <section class="st-ui-no-results st-search-suggestions"><div class="st-query-not-present">
      </div></section>
    </div>



    <!-- FOOTER -->
    <div class="st-ui-container-footer_bar st-position-container">
      <section class="st-ui-footer">
          <span class="st-ui-search-summary st-search-summary"></span>
        <span class="st-ui-pagination st-search-pagination"></span>
      </section>
    </div>
  </div>
</div>
<div class="st-default-autocomplete" data-st-target-element=".st-default-search-input" style="position: absolute; top: 49px; left: 0px; z-index: 999999; display: none; ">
  <div class="st-autocomplete-results st-ui-autocomplete"><div class="st-query-present" style="display: none; "></div></div>
</div>
</div></body></html>